---
title: "Input properties"
author: "O. Denas"
date: "9/29/2017"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


#Input properties
```{r, echo=FALSE, message=FALSE}
library(tidyverse)
library(ggridges)

rm(list = ls())

ddir <- '../input_stats_data/exploration/datasets/data_dir/'
all_data <- (do.call(rbind, lapply(list.files(ddir, pattern = '*.csv'), function(fname){
  read_csv(sprintf("%s/%s", ddir, fname)) %>% 
    mutate(b_path = strsplit(fname, split = ".", fixed = TRUE)[[1]][1]) 
  })) %>% 
    separate(b_path, into=c('stype', 'slen', 'ttype', 'tlen', 'alp', 'rep_mut', 'sim_mut')) %>% 
    unite(col = inp_type, stype, ttype, sep = "_")
) %>% select(measuring, where, key, value, trial, alp, rep_mut, sim_mut)
#all_data

node_data <- (all_data %>% 
                filter(measuring == "wl_calls", where == "ms") %>% mutate(value = as.numeric(value)) %>% 
                separate(key, into=c('char', 'maxrep', 'has_wl', 'wide_i')) %>%
                select(alp, wide_i, char, has_wl, maxrep, rep_mut, sim_mut, value, trial))
#node_data

pdata <- (all_data %>% 
            filter(measuring == "pseq", where == "ms") %>% 
            mutate(value = as.numeric(value), key = as.numeric(key)) %>% 
            select(alp, key, rep_mut, sim_mut, value, trial))
#pdata

wldata <- (all_data %>% 
             filter(measuring == "wlseq", where == "ms") %>% 
             mutate(value = as.numeric(value), key = as.numeric(key)) %>% 
             select(alp, key, rep_mut, sim_mut, value, trial))
#wldata
```

Experiments are performed on the following inputs:

```{r, echo=FALSE}
library(knitr)
kable(tibble(path = list.files("../input_stats_data/exploration/datasets/data_dir", pattern = "*.s$")) %>% 
        separate(path, into = c("s_type", "sl", "t_type", "tl", "alp", "rep_mut", "sim_mut", "suff")) %>% 
        separate(sl, into=c('slen', 'ssuff'), sep="s") %>% 
        separate(tl, into=c('tlen', 'tsuff'), sep="t") %>% 
        select(s_type, t_type, slen, tlen, alp, rep_mut, sim_mut) %>% 
        mutate(slen = as.numeric(slen), tlen = as.numeric(tlen), alp=str_length(alp),
               num_blocks=1000, block_len = slen / num_blocks, 
               s_mutation_rate = as.numeric(rep_mut) / block_len, t_mutation_rate = as.numeric(sim_mut) / tlen) %>% 
        select(-s_type, -t_type), 
  caption = "Input datasets", 
  format.args = list(decimal.mark = ",", big.mark = "'", scientific=FALSE))
```

The index (aka $S$) is generated by the concatenation of $(s_1, \ldots, s_k)$ where  $\sum_i |s_i| = |S|$. The query (aka $T$) is generated by mutating $S[1..|T|]$.

Description of columns:

 * slen/tlen: length of the index/query string. I.e., $|S|$ and $|T|$.
 * alp: the alphabet length 
 * rep_mut: number of mutations introduced to block $s_1$ to obtain blocks $s_i$ with $1 < i \leq k$.
 * sim_mut: number of mutations introduced to $S[1..|T|]$ in order to obtain $T$ -- I.e., $T$ differs from $S$ by `sim_mut` characters.
 * num_blocks: number of blocks to obtain $S$ ($k$ above).
 * block_len: length of $s_i$ for $1\leq i\leq n$
 * s_mutation_rate: `sim_mut` / `block_len` 
 * t_mutation_rate:  `sim_mut` / `tlen`

Notice that the row with `rep_mut=rep_sim=1` has `S` that is a almost a perfect repeat of blocks, and `T` almost a perfect copy of it. 

On the other hand, `rep_mut=block_len` and `rep_sim=` $|T|$ has `S` pretty much random (since we are  mutating all chars of a block) and `T` having mismatches everywhere.

## Node properties
Before making a `wl(v, c)` call register whether `v` is a maximal repeat, and whether the Weiner link exists or not. 

```{r, echo=FALSE, fig.height=8}

node_dataa <- (node_data %>% unite(node_type, maxrep, has_wl) %>% 
  group_by(alp, node_type, rep_mut, sim_mut, trial) %>% summarise(value = sum(value)) %>% ungroup()
)


ggplot(node_dataa %>% filter(alp != 'abcde'), aes(x = value, y = rep_mut)) + 
  geom_density_ridges() + facet_wrap(sim_mut~node_type, scales='free', ncol = 4) 

ggplot(node_dataa %>% filter(alp != 'abcde'), aes(x = value, y = sim_mut)) + 
  geom_density_ridges() + facet_wrap(rep_mut~node_type, scales='free', ncol = 4) 
```

## Consecutive wl() calls
During the MS vector construction, count the number of consecutive wl() calls due to matches between reversed indexed string and the query. In other words count the $k$-length iterations of the while cycle.

```{r, echo=FALSE}
xl <- "Nr. of consecutive wl calls"

wldataa <- wldata %>% group_by(alp, key, rep_mut, sim_mut) %>% summarise(value = mean(value)) %>% ungroup()

ggplot(wldataa, aes(key, value, color=factor(sim_mut))) + geom_point() + scale_y_log10() + facet_wrap(sim_mut~rep_mut, scales = "free_x", ncol = 3)

ggplot(wldataa, aes(key, value, color=factor(rep_mut))) + geom_point() + scale_y_log10() + facet_wrap(~sim_mut, scales = "free_x")
```

## Consecutive parent() calls
During the MS vector construction, count the number of consecutive `parent()` calls after a failed `wl()` call.

```{r, echo=FALSE}
xl <- "Nr. of consecutive parent calls"

pdataa <- pdata %>% group_by(alp, key, rep_mut, sim_mut) %>% summarise(value = mean(value)) %>% ungroup()

ggplot(pdataa, aes(key, value, color=factor(sim_mut))) + geom_point() + scale_y_log10() + facet_wrap(~rep_mut, scales = "free_x")

ggplot(pdataa, aes(key, value, color=factor(rep_mut))) + geom_point() + scale_y_log10() + facet_wrap(~sim_mut, scales = "free_x")
```
