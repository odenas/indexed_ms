---
title: "custom_input"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
library(tidyverse)
source('utils.R')
```

```{r}
time_data <- (rbind(
  read_many_csv(
    list.files('../input_stats_data/exploration/index_based_query/',
             pattern = '*lca.csv', full.names = TRUE)),
  read_many_csv(
    list.files('../input_stats_data/exploration/index_based_query/',
             pattern = '*pseq.csv', full.names = TRUE))
  ) %>% 
    filter(item == 'ms_bvector') %>%
    separate(b_path, c('inp_type', 'lb', 'csv'), sep = "[.]") %>% 
    select(-len_s, -len_t, -item, -lb, -csv) %>% 
    mutate(alp = 'abcdef')
)


prange_plot(time_data %>% 
              spread(key = label, value = value) %>%  
              group_by(inp_type) %>% 
              mutate(rel_diff = (lca - mean(pseq)) / pmax(lca, mean(pseq)))) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size=8))
```


```{r}

istat_data <- (
  read_many_csv(
    list.files('../input_stats_data/exploration/index_based_query',
               pattern='*.istat.csv', full.names = TRUE)) %>% 
    filter(measuring == 'pseq') %>% 
    mutate(key = as.numeric(key))
)
istat_data

ggplot(istat_data, aes(key, value, color=where)) + geom_point() + geom_line() + facet_wrap(~b_path) #+ xlim(1, 12)



```

# index based query



```{r}
library(tidyverse)
library(manipulate)
library(ggridges)
ds <- read_csv('../input_stats_data/exploration/index_based_query/res.csv')
ggplot(ds, aes(x=depth, y=num_mut, group=num_mut)) + geom_density_ridges() + theme_ridges()

ggplot(ds %>% filter(node_depth < 15), aes(num_mut, node_depth, group=num_mut)) + geom_boxplot(outlier.shape = NA)


ggplot(ds %>% filter(node_depth < 40), aes(node_depth)) + geom_histogram(bins=30) + facet_grid(num_mut~.) 

ggplot(ds %>% filter(node_depth > 15), aes(node_depth, color=factor(num_mut))) + stat_ecdf(geom="step")


manipulate(plot(ecdf((ds %>% filter(num_mut==k))$node_depth)), k=slider(min=10, max=100, step=10, initial = 10))
```
